<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Administrador - Algoritmo</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .login-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 3rem;
            width: 90%;
            max-width: 450px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.2);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .logo {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .logo-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }
        
        h1 {
            color: white;
            font-size: 2rem;
            font-weight: 900;
            text-align: center;
            margin-bottom: 0.5rem;
        }
        
        .subtitle {
            color: rgba(255,255,255,0.8);
            text-align: center;
            margin-bottom: 2rem;
            font-size: 0.9rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        label {
            display: block;
            color: white;
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }
        
        input {
            width: 100%;
            padding: 1rem;
            background: rgba(255,255,255,0.9);
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        input:focus {
            outline: none;
            background: white;
            box-shadow: 0 0 0 3px rgba(255,255,255,0.3);
        }
        
        .btn-login {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 1rem;
        }
        
        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .btn-login:active {
            transform: translateY(0);
        }
        
        .error-message {
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid #ef4444;
            color: white;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            display: none;
            text-align: center;
            font-weight: 600;
        }
        
        .admin-panel {
            display: none;
            background: #0f172a;
            min-height: 100vh;
            color: white;
            width: 100%;
        }
        
        .admin-header {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid rgba(255,255,255,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .admin-logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .admin-logo-icon {
            font-size: 2rem;
        }
        
        .admin-title {
            font-size: 1.5rem;
            font-weight: 900;
        }
        
        .admin-user {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .btn-logout {
            padding: 0.75rem 1.5rem;
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid #ef4444;
            border-radius: 8px;
            color: #ef4444;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-logout:hover {
            background: #ef4444;
            color: white;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1.5rem;
            width: 100%;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }
        
        .stat-card {
            background: rgba(30, 41, 59, 0.5);
            border-radius: 15px;
            padding: 2rem;
            text-align: center;
            border: 2px solid rgba(255,255,255,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .stat-value {
            font-size: 3rem;
            font-weight: 900;
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            color: rgba(255,255,255,0.7);
            font-size: 1rem;
        }
        
        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            overflow-x: auto;
            padding-bottom: 0.5rem;
        }
        
        .tab-btn {
            padding: 1rem 2rem;
            background: rgba(30, 41, 59, 0.5);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            color: white;
            font-weight: 700;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s;
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-color: transparent;
        }
        
        .tab-content {
            display: none;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 15px;
            padding: 2rem;
            border: 2px solid rgba(255,255,255,0.1);
        }
        
        .tab-content.active {
            display: block;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background: rgba(255,255,255,0.05);
            padding: 1rem;
            text-align: left;
            font-weight: 700;
            border-bottom: 2px solid rgba(255,255,255,0.1);
        }
        
        td {
            padding: 1rem;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        
        tr:hover {
            background: rgba(255,255,255,0.03);
        }
        
        .badge {
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.85rem;
        }
        
        .badge-artista {
            background: rgba(124, 58, 237, 0.2);
            color: #7c3aed;
        }
        
        .badge-curador {
            background: rgba(236, 72, 153, 0.2);
            color: #ec4899;
        }

        .badge-pendiente {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
        }

        .badge-aprobada {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }
        
        .btn-action {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            margin-right: 0.5rem;
            transition: transform 0.2s;
        }
        
        .btn-action:hover {
            transform: scale(1.05);
        }

        .btn-action:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-view {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
        }
        
        .btn-delete {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .btn-verify {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
        }

        .btn-approve {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .btn-reject {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }
        
        .search-box {
            width: 100%;
            max-width: 400px;
            padding: 0.75rem 1rem;
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            color: white !important;
            font-size: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .search-box:focus {
            outline: none;
            border-color: rgba(124, 58, 237, 0.8);
            background: rgba(255,255,255,0.1);
        }
        
        .search-box::placeholder {
            color: rgba(255,255,255,0.5);
        }
        
        .filters {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 0.6rem 1.2rem;
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .filter-btn.active {
            background: rgba(124, 58, 237, 0.3);
            border-color: #7c3aed;
        }
        
        .config-section {
            background: rgba(255,255,255,0.03);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .config-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
        }
        
        .config-field {
            margin-bottom: 1rem;
        }
        
        .config-label {
            display: block;
            color: rgba(255,255,255,0.8);
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        
        .config-input {
            width: 200px;
            padding: 0.75rem;
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            color: white;
        }
        
        .btn-save {
            padding: 0.75rem 1.5rem;
            background: #10b981;
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 700;
            cursor: pointer;
            margin-top: 1rem;
        }
        
        .btn-danger {
            padding: 0.75rem 1.5rem;
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid #ef4444;
            border-radius: 8px;
            color: #ef4444;
            font-weight: 700;
            cursor: pointer;
            margin-right: 1rem;
        }

        .playlist-card {
            background: rgba(255,255,255,0.03);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 2px solid rgba(255,255,255,0.1);
        }

        .playlist-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .playlist-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .playlist-info {
            color: rgba(255,255,255,0.7);
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .spotify-data {
            background: rgba(16, 185, 129, 0.1);
            border: 2px solid rgba(16, 185, 129, 0.3);
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .spotify-data h4 {
            color: #10b981;
            margin-bottom: 0.75rem;
            font-size: 1.1rem;
        }

        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }

        .data-item {
            font-size: 0.9rem;
        }

        .data-label {
            color: rgba(255,255,255,0.6);
            margin-bottom: 0.25rem;
        }

        .data-value {
            color: white;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <!-- Pantalla de Login -->
    <div class="login-container" id="loginScreen">
        <div class="logo">
            <div class="logo-icon">üëë</div>
            <h1>Panel de Administrador</h1>
            <p class="subtitle">Acceso restringido solo para administradores</p>
        </div>
        
        <div class="error-message" id="errorMessage">
            ‚ö†Ô∏è Credenciales incorrectas
        </div>
        
        <form id="loginForm" onsubmit="handleLogin(event)">
            <div class="form-group">
                <label for="adminEmail">Email de Administrador</label>
                <input type="email" id="adminEmail" required placeholder="admin@algoritmo.com">
            </div>
            
            <div class="form-group">
                <label for="adminPassword">Contrase√±a</label>
                <input type="password" id="adminPassword" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            </div>
            
            <button type="submit" class="btn-login">
                üîê Iniciar Sesi√≥n
            </button>
        </form>
    </div>

    <!-- Panel de Administrador -->
    <div class="admin-panel" id="adminPanel">
        <header class="admin-header">
            <div class="admin-logo">
                <div class="admin-logo-icon">üëë</div>
                <div class="admin-title">Panel de Administrador</div>
            </div>
            <div class="admin-user">
                <span id="adminName">Admin</span>
                <button class="btn-logout" onclick="logout()">üö™ Cerrar Sesi√≥n</button>
            </div>
        </header>

        <div class="container">
            <!-- Estad√≠sticas -->
            <div class="stats-grid">
                <div class="stat-card" style="border-color: #10b981;">
                    <div class="stat-value" style="color: #10b981;" id="totalUsuarios">0</div>
                    <div class="stat-label">Total Usuarios</div>
                </div>
                <div class="stat-card" style="border-color: #7c3aed;">
                    <div class="stat-value" style="color: #7c3aed;" id="totalArtistas">0</div>
                    <div class="stat-label">Artistas</div>
                </div>
                <div class="stat-card" style="border-color: #ec4899;">
                    <div class="stat-value" style="color: #ec4899;" id="totalCuradores">0</div>
                    <div class="stat-label">Curadores</div>
                </div>
                <div class="stat-card" style="border-color: #fbbf24;">
                    <div class="stat-value" style="color: #fbbf24;" id="playlistsPendientes">0</div>
                    <div class="stat-label">Playlists Pendientes</div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="tabs">
                <button class="tab-btn active" onclick="changeTab('usuarios')">üë• Usuarios</button>
                <button class="tab-btn" onclick="changeTab('aprobarPlaylists')">üìã Aprobar Playlists</button>
                <button class="tab-btn" onclick="changeTab('transacciones')">üí∞ Transacciones</button>
                <button class="tab-btn" onclick="changeTab('envios')">üì® Env√≠os</button>
                <button class="tab-btn" onclick="changeTab('playlists')">üéµ Playlists</button>
                <button class="tab-btn" onclick="changeTab('reportes')">üìä Reportes</button>
                <button class="tab-btn" onclick="changeTab('configuracion')">‚öôÔ∏è Configuraci√≥n</button>
            </div>

            <!-- Tab: Usuarios -->
            <div class="tab-content active" id="tabUsuarios">
                <h2 style="font-size: 1.8rem; font-weight: 800; margin-bottom: 1.5rem;">üë• Gesti√≥n de Usuarios</h2>
                
                <input type="text" class="search-box" id="searchUsuarios" placeholder="üîç Buscar usuario..." oninput="filtrarUsuarios()">
                
                <div class="filters">
                    <button class="filter-btn active" onclick="filtrarPorTipo('todos')">Todos</button>
                    <button class="filter-btn" onclick="filtrarPorTipo('artista')">Artistas</button>
                    <button class="filter-btn" onclick="filtrarPorTipo('curador')">Curadores</button>
                </div>
                
                <div style="overflow-x: auto;">
                    <table>
                        <thead>
                            <tr>
                                <th>Usuario</th>
                                <th>Email</th>
                                <th>Tipo</th>
                                <th>Fecha Registro</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tablaUsuarios">
                            <tr>
                                <td colspan="5" style="text-align: center; padding: 3rem; color: rgba(255,255,255,0.5);">
                                    Cargando usuarios...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Tab: APROBAR PLAYLISTS (NUEVO) -->
            <div class="tab-content" id="tabAprobarPlaylists">
                <h2 style="font-size: 1.8rem; font-weight: 800; margin-bottom: 1.5rem;">üìã Aprobar Playlists Pendientes</h2>
                
                <div id="playlistsPendientesContainer">
                    <div style="text-align: center; padding: 3rem; color: rgba(255,255,255,0.5);">
                        ‚è≥ Cargando playlists pendientes...
                    </div>
                </div>
            </div>

            <!-- Tab: Transacciones -->
            <div class="tab-content" id="tabTransacciones">
                <h2 style="font-size: 1.8rem; font-weight: 800; margin-bottom: 1.5rem;">üí∞ Historial de Transacciones</h2>
                <div style="overflow-x: auto;">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Usuario</th>
                                <th>Tipo</th>
                                <th>Monto</th>
                                <th>Estado</th>
                                <th>Fecha</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 3rem; color: rgba(255,255,255,0.5);">
                                    No hay transacciones a√∫n
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Tab: Env√≠os -->
            <div class="tab-content" id="tabEnvios">
                <h2 style="font-size: 1.8rem; font-weight: 800; margin-bottom: 1.5rem;">üì® Gesti√≥n de Env√≠os</h2>
                <div style="overflow-x: auto;">
                    <table>
                        <thead>
                            <tr>
                                <th>Artista</th>
                                <th>Canci√≥n</th>
                                <th>Playlist</th>
                                <th>Curador</th>
                                <th>Estado</th>
                                <th>Fecha</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 3rem; color: rgba(255,255,255,0.5);">
                                    No hay env√≠os a√∫n
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Tab: Playlists -->
            <div class="tab-content" id="tabPlaylists">
                <h2 style="font-size: 1.8rem; font-weight: 800; margin-bottom: 1.5rem;">üéµ Todas las Playlists</h2>
                
                <div class="filters">
                    <button class="filter-btn active" onclick="filtrarPlaylistsPorEstado('todas')">üìä Todas</button>
                    <button class="filter-btn" onclick="filtrarPlaylistsPorEstado('aprobada')">‚úÖ Aprobadas</button>
                    <button class="filter-btn" onclick="filtrarPlaylistsPorEstado('pendiente')">‚è≥ Pendientes</button>
                    <button class="filter-btn" onclick="filtrarPlaylistsPorEstado('rechazada')">‚ùå Rechazadas</button>
                </div>

                <div style="overflow-x: auto;">
                    <table>
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Curador</th>
                                <th>Seguidores</th>
                                <th>Estado</th>
                                <th>Fecha</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tablaTodasPlaylists">
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 3rem; color: rgba(255,255,255,0.5);">
                                    Cargando playlists...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Tab: Reportes -->
            <div class="tab-content" id="tabReportes">
                <h2 style="font-size: 1.8rem; font-weight: 800; margin-bottom: 1.5rem;">üìä Reportes y Estad√≠sticas</h2>
                
                <div class="stats-grid" style="margin-bottom: 2rem;">
                    <div class="stat-card" style="border-color: #10b981;">
                        <div class="stat-value" style="color: #10b981;">0‚Ç¨</div>
                        <div class="stat-label">üí∏ Ingresos del Mes</div>
                        <div style="color: rgba(255,255,255,0.6); margin-top: 0.5rem;">üìà +0% vs mes anterior</div>
                    </div>
                    <div class="stat-card" style="border-color: #7c3aed;">
                        <div class="stat-value" style="color: #7c3aed;">0</div>
                        <div class="stat-label">üéµ Env√≠os del Mes</div>
                        <div style="color: rgba(255,255,255,0.6); margin-top: 0.5rem;">üìà +0% vs mes anterior</div>
                    </div>
                    <div class="stat-card" style="border-color: #ec4899;">
                        <div class="stat-value" style="color: #ec4899;">0</div>
                        <div class="stat-label">üë• Nuevos Usuarios</div>
                        <div style="color: rgba(255,255,255,0.6); margin-top: 0.5rem;">üìà +0% vs mes anterior</div>
                    </div>
                </div>

                <button class="btn-save" onclick="exportarReporte()">üì• Exportar Reporte CSV</button>
            </div>

            <!-- Tab: Configuraci√≥n -->
            <div class="tab-content" id="tabConfiguracion">
                <h2 style="font-size: 1.8rem; font-weight: 800; margin-bottom: 1.5rem;">‚öôÔ∏è Configuraci√≥n de la Plataforma</h2>
                
                <div class="config-section">
                    <h3 class="config-title">üí∞ Configuraci√≥n de Precios</h3>
                    <div class="config-field">
                        <label class="config-label">Precio Standard (‚Ç¨):</label>
                        <input type="number" class="config-input" id="precioStandard" value="0.50" step="0.10">
                    </div>
                    <div class="config-field">
                        <label class="config-label">Precio Premium (‚Ç¨):</label>
                        <input type="number" class="config-input" id="precioPremium" value="2.00" step="0.10">
                    </div>
                    <button class="btn-save" onclick="guardarPrecios()">üíæ Guardar Cambios</button>
                </div>

                <div class="config-section">
                    <h3 class="config-title">üìä Comisiones</h3>
                    <div class="config-field">
                        <label class="config-label">Comisi√≥n Plataforma (%):</label>
                        <input type="number" class="config-input" id="comisionPlataforma" value="5" step="1" min="0" max="100">
                    </div>
                    <div class="config-field">
                        <label class="config-label">Comisi√≥n Referidos (%):</label>
                        <input type="number" class="config-input" id="comisionReferidos" value="15" step="1" min="0" max="100">
                    </div>
                    <button class="btn-save" onclick="guardarComisiones()">üíæ Guardar Cambios</button>
                </div>

                <div class="config-section">
                    <h3 class="config-title">üîß Mantenimiento</h3>
                    <button class="btn-danger" onclick="limpiarCache()">üßπ Limpiar Cach√©</button>
                    <button class="btn-danger" onclick="resetearDatos()">‚ö†Ô∏è Resetear Datos Demo</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========================================
        // CONFIGURACI√ìN SUPABASE
        // ========================================
        const SUPABASE_URL = 'https://wesmqqaijlmqhctrtaje.supabase.co';
        const SUPABASE_ANON_KEY = 'sb_publishable_LgSAsCVW7tlDfDvkD8enyA_pQp42IZF';
        
        let supabaseClient;
        if (typeof supabase !== 'undefined') {
            supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            console.log('‚úÖ Supabase inicializado en Admin Panel');
        } else {
            console.error('‚ùå Supabase no est√° disponible');
        }
        
        // ========================================
        // CREDENCIALES DE ADMINISTRADOR
        // ========================================
        const ADMIN_CREDENTIALS = {
            email: 'micael@algoritmo.com',
            password: 'Algoritmo2026!'
        };

        // ========================================
        // LOGIN DE ADMINISTRADOR
        // ========================================
        async function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;
            
            if (email === ADMIN_CREDENTIALS.email && password === ADMIN_CREDENTIALS.password) {
                // Login exitoso
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
                
                // Guardar sesi√≥n
                sessionStorage.setItem('adminLoggedIn', 'true');
                sessionStorage.setItem('adminEmail', email);
                
                // Cargar datos REALES de Supabase
                await cargarUsuariosReales();
                await cargarPlaylistsPendientes();
                await cargarTodasPlaylists();
                
                console.log('‚úÖ Login de administrador exitoso');
            } else {
                // Login fallido
                document.getElementById('errorMessage').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('errorMessage').style.display = 'none';
                }, 3000);
                console.log('‚ùå Credenciales incorrectas');
            }
        }

        // Logout
        function logout() {
            if (confirm('¬øCerrar sesi√≥n de administrador?')) {
                sessionStorage.clear();
                location.reload();
            }
        }

        // Cambiar tab
        function changeTab(tabName) {
            // Ocultar todos los tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Mostrar tab seleccionado
            document.getElementById('tab' + tabName.charAt(0).toUpperCase() + tabName.slice(1)).classList.add('active');
            event.target.classList.add('active');

            // Cargar datos seg√∫n la tab
            if (tabName === 'aprobarPlaylists') {
                cargarPlaylistsPendientes();
            } else if (tabName === 'playlists') {
                cargarTodasPlaylists();
            }
        }

        // ========================================
        // CARGAR USUARIOS REALES DE SUPABASE
        // ========================================
        async function cargarUsuariosReales() {
            try {
                console.log('üîÑ Cargando usuarios de Supabase...');
                
                const { data: usuarios, error } = await supabaseClient
                    .from('usuarios')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (error) {
                    console.error('‚ùå Error al cargar usuarios:', error);
                    alert('Error al cargar usuarios');
                    return;
                }
                
                console.log('‚úÖ Usuarios cargados:', usuarios);
                
                const tbody = document.getElementById('tablaUsuarios');
                tbody.innerHTML = '';
                
                if (!usuarios || usuarios.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 2rem; color: rgba(255,255,255,0.5);">No hay usuarios registrados</td></tr>';
                    document.getElementById('totalUsuarios').textContent = '0';
                    document.getElementById('totalArtistas').textContent = '0';
                    document.getElementById('totalCuradores').textContent = '0';
                    return;
                }
                
                usuarios.forEach(user => {
                    const badgeClass = user.tipo === 'artista' ? 'badge-artista' : 'badge-curador';
                    const icon = user.tipo === 'artista' ? 'üéµ' : 'üéß';
                    const fecha = new Date(user.created_at).toLocaleDateString('es-ES');
                    
                    tbody.innerHTML += `
                        <tr>
                            <td>${user.nombre}</td>
                            <td style="color: rgba(255,255,255,0.7);">${user.email}</td>
                            <td><span class="badge ${badgeClass}">${icon} ${user.tipo.charAt(0).toUpperCase() + user.tipo.slice(1)}</span></td>
                            <td style="color: rgba(255,255,255,0.7);">${fecha}</td>
                            <td>
                                <button class="btn-action btn-view" onclick="verUsuario('${user.id}', '${user.email}')">üëÅÔ∏è Ver</button>
                                <button class="btn-action btn-delete" onclick="eliminarUsuario('${user.id}', '${user.email}')">üóëÔ∏è Eliminar</button>
                            </td>
                        </tr>
                    `;
                });
                
                // Actualizar estad√≠sticas
                document.getElementById('totalUsuarios').textContent = usuarios.length;
                document.getElementById('totalArtistas').textContent = usuarios.filter(u => u.tipo === 'artista').length;
                document.getElementById('totalCuradores').textContent = usuarios.filter(u => u.tipo === 'curador').length;
                
            } catch (err) {
                console.error('‚ùå Error inesperado:', err);
                alert('Error al cargar datos');
            }
        }

        // ========================================
        // CARGAR PLAYLISTS PENDIENTES
        // ========================================
        async function cargarPlaylistsPendientes() {
            try {
                console.log('üîÑ Cargando playlists pendientes...');
                
                const { data: playlists, error } = await supabaseClient
                    .from('playlists')
                    .select(`
                        id,
                        nombre,
                        url_spotify,
                        spotify_playlist_id,
                        followers,
                        created_at,
                        usuarios!playlists_curador_id_fkey (
                            nombre,
                            email
                        )
                    `)
                    .eq('estado', 'pendiente')
                    .order('created_at', { ascending: false });
                
                if (error) {
                    console.error('‚ùå Error:', error);
                    throw error;
                }
                
                const container = document.getElementById('playlistsPendientesContainer');
                
                if (!playlists || playlists.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 3rem; color: rgba(255,255,255,0.5);">
                            <h3 style="font-size: 2rem; margin-bottom: 1rem;">‚úÖ ¬°Todo revisado!</h3>
                            <p>No hay playlists pendientes de aprobaci√≥n</p>
                        </div>
                    `;
                    document.getElementById('playlistsPendientes').textContent = '0';
                    return;
                }
                
                document.getElementById('playlistsPendientes').textContent = playlists.length;
                
                container.innerHTML = playlists.map(playlist => `
                    <div class="playlist-card" id="playlist-${playlist.id}">
                        <div class="playlist-header">
                            <div>
                                <div class="playlist-title">${playlist.nombre || 'Sin nombre'}</div>
                                <div class="playlist-info">
                                    üë§ Curador: <strong>${playlist.usuarios?.nombre || 'Desconocido'}</strong><br>
                                    üìß Email: ${playlist.usuarios?.email || 'N/A'}<br>
                                    üìÖ Enviado: ${new Date(playlist.created_at).toLocaleString('es-ES')}<br>
                                    üîó <a href="${playlist.url_spotify || '#'}" target="_blank" style="color: #1db954;">Ver en Spotify</a>
                                </div>
                            </div>
                            <span class="badge badge-pendiente">‚è≥ PENDIENTE</span>
                        </div>
                        
                        <div id="spotifyData-${playlist.id}"></div>
                        
                        <div style="display: flex; gap: 1rem; margin-top: 1rem; flex-wrap: wrap;">
                            <button class="btn-action btn-verify" onclick="verificarPlaylist('${playlist.id}', '${playlist.spotify_playlist_id || ''}')">
                                üîç Verificar Datos
                            </button>
                            <button class="btn-action btn-approve" onclick="aprobarPlaylist('${playlist.id}')" id="btnAprobar-${playlist.id}" disabled>
                                ‚úÖ Aprobar
                            </button>
                            <button class="btn-action btn-reject" onclick="rechazarPlaylist('${playlist.id}')">
                                ‚ùå Rechazar
                            </button>
                        </div>
                    </div>
                `).join('');
                
            } catch (err) {
                console.error('‚ùå Error:', err);
                document.getElementById('playlistsPendientesContainer').innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: rgba(255,255,255,0.5);">
                        <h3 style="color: #ef4444; margin-bottom: 1rem;">‚ö†Ô∏è Error</h3>
                        <p>${err.message}</p>
                    </div>
                `;
            }
        }

        // ========================================
        // CARGAR TODAS LAS PLAYLISTS
        // ========================================
        async function cargarTodasPlaylists() {
            try {
                console.log('üîÑ Cargando todas las playlists...');
                
                const { data: playlists, error } = await supabaseClient
                    .from('playlists')
                    .select(`
                        id,
                        nombre,
                        followers,
                        estado,
                        url_spotify,
                        created_at,
                        motivo_rechazo,
                        usuarios!playlists_curador_id_fkey (
                            nombre,
                            email
                        )
                    `)
                    .order('created_at', { ascending: false });
                
                if (error) {
                    console.error('‚ùå Error:', error);
                    throw error;
                }
                
                const tbody = document.getElementById('tablaTodasPlaylists');
                
                if (!playlists || playlists.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 2rem; color: rgba(255,255,255,0.5);">No hay playlists registradas</td></tr>';
                    return;
                }
                
                tbody.innerHTML = '';
                
                playlists.forEach(playlist => {
                    let estadoBadge = '';
                    let estadoClass = '';
                    
                    if (playlist.estado === 'aprobada') {
                        estadoBadge = '‚úÖ Aprobada';
                        estadoClass = 'badge-aprobada';
                    } else if (playlist.estado === 'pendiente') {
                        estadoBadge = '‚è≥ Pendiente';
                        estadoClass = 'badge-pendiente';
                    } else if (playlist.estado === 'rechazada') {
                        estadoBadge = '‚ùå Rechazada';
                        estadoClass = 'badge';
                    }
                    
                    const fecha = new Date(playlist.created_at).toLocaleDateString('es-ES');
                    
                    tbody.innerHTML += `
                        <tr data-estado="${playlist.estado}">
                            <td>
                                <strong>${playlist.nombre || 'Sin nombre'}</strong>
                                ${playlist.motivo_rechazo ? `<br><small style="color: #ef4444;">Motivo: ${playlist.motivo_rechazo}</small>` : ''}
                            </td>
                            <td style="color: rgba(255,255,255,0.7);">
                                ${playlist.usuarios?.nombre || 'Desconocido'}<br>
                                <small>${playlist.usuarios?.email || 'N/A'}</small>
                            </td>
                            <td style="color: rgba(255,255,255,0.7);">
                                üë• ${(playlist.followers || 0).toLocaleString()}
                            </td>
                            <td>
                                <span class="badge ${estadoClass}">${estadoBadge}</span>
                            </td>
                            <td style="color: rgba(255,255,255,0.7);">${fecha}</td>
                            <td>
                                ${playlist.url_spotify ? `<a href="${playlist.url_spotify}" target="_blank" class="btn-action btn-view">üéµ Ver</a>` : ''}
                                <button class="btn-action btn-delete" onclick="eliminarPlaylistAdmin('${playlist.id}', '${playlist.nombre}')">üóëÔ∏è Eliminar</button>
                            </td>
                        </tr>
                    `;
                });
                
                console.log('‚úÖ Playlists cargadas:', playlists.length);
                
            } catch (err) {
                console.error('‚ùå Error:', err);
                document.getElementById('tablaTodasPlaylists').innerHTML = `
                    <tr><td colspan="6" style="text-align: center; padding: 2rem; color: #ef4444;">Error al cargar playlists</td></tr>
                `;
            }
        }

        // ========================================
        // FILTRAR PLAYLISTS POR ESTADO
        // ========================================
        function filtrarPlaylistsPorEstado(estado) {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            const rows = document.querySelectorAll('#tablaTodasPlaylists tr[data-estado]');
            
            rows.forEach(row => {
                if (estado === 'todas') {
                    row.style.display = '';
                } else {
                    row.style.display = row.dataset.estado === estado ? '' : 'none';
                }
            });
        }

        // ========================================
        // ELIMINAR PLAYLIST (ADMIN)
        // ========================================
        async function eliminarPlaylistAdmin(playlistId, nombre) {
            if (!confirm(`¬øEliminar playlist "${nombre}"?\n\n‚ö†Ô∏è Esta acci√≥n no se puede deshacer.`)) {
                return;
            }
            
            try {
                const { error } = await supabaseClient
                    .from('playlists')
                    .delete()
                    .eq('id', playlistId);
                
                if (error) throw error;
                
                alert('‚úÖ Playlist eliminada correctamente');
                await cargarTodasPlaylists();
                await cargarPlaylistsPendientes(); // Actualizar contador
                
            } catch (err) {
                console.error('Error:', err);
                alert('‚ùå Error al eliminar playlist');
            }
        }

        // ========================================
        // VERIFICAR PLAYLIST MANUALMENTE
        // ========================================
        async function verificarPlaylist(playlistId, spotifyId) {
            if (!spotifyId) {
                alert('‚ö†Ô∏è Esta playlist no tiene ID de Spotify');
                return;
            }
            
            // Primero dar instrucciones
            if (!confirm('üîç VERIFICAR PLAYLIST\n\n1. Se abrir√° Spotify en una nueva pesta√±a\n2. Verifica los datos de la playlist\n3. Vuelve a esta pesta√±a para introducir los datos\n\n¬øContinuar?')) {
                return;
            }
            
            // Abrir Spotify en nueva pesta√±a
            window.open(`https://open.spotify.com/playlist/${spotifyId}`, '_blank');
            
            // Mostrar instrucci√≥n clara
            alert('üëÄ Mira la pesta√±a de Spotify que se abri√≥\n\nüìù Anota:\n- N√∫mero de seguidores\n- Nombre de la playlist\n\n‚úÖ Luego haz click en OK para continuar');
            
            // Ahora pedir los datos
            const followers = prompt('üë• ¬øCu√°ntos SEGUIDORES tiene la playlist?\n\n(Introduce solo el n√∫mero)\n\nEjemplo: 1234');
            
            if (!followers || followers.trim() === '' || isNaN(followers)) {
                alert('‚ö†Ô∏è Debes introducir un n√∫mero v√°lido de seguidores');
                return;
            }
            
            const name = prompt('üéµ ¬øCu√°l es el NOMBRE de la playlist?\n\n(C√≥pialo exactamente como aparece)');
            
            if (!name || name.trim() === '') {
                alert('‚ö†Ô∏è Debes introducir el nombre de la playlist');
                return;
            }
            
            // Mostrar datos verificados
            document.getElementById(`spotifyData-${playlistId}`).innerHTML = `
                <div class="spotify-data">
                    <h4>‚úÖ Datos Verificados</h4>
                    <div class="data-grid">
                        <div class="data-item">
                            <div class="data-label">Nombre:</div>
                            <div class="data-value">${name}</div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">Seguidores:</div>
                            <div class="data-value">${parseInt(followers).toLocaleString()}</div>
                        </div>
                    </div>
                    <div style="margin-top: 1rem; padding: 0.75rem; background: rgba(59, 130, 246, 0.1); border-radius: 0.5rem; color: rgba(255,255,255,0.8); font-size: 0.9rem;">
                        üí° Verifica que el due√±o de la playlist coincida con el email del curador antes de aprobar
                    </div>
                </div>
            `;
            
            // Habilitar bot√≥n aprobar
            const btn = document.getElementById(`btnAprobar-${playlistId}`);
            btn.disabled = false;
            btn.dataset.followers = followers.trim();
            btn.dataset.name = name.trim();
            btn.dataset.image = '';
            
            console.log('‚úÖ Datos verificados manualmente');
        }

        // ========================================
        // APROBAR PLAYLIST
        // ========================================
        async function aprobarPlaylist(playlistId) {
            const btn = document.getElementById(`btnAprobar-${playlistId}`);
            const followers = btn.dataset.followers;
            const name = btn.dataset.name;
            const image = btn.dataset.image;
            
            if (!followers || !name) {
                alert('‚ö†Ô∏è Primero verifica la playlist');
                return;
            }
            
            if (!confirm(`¬øAprobar esta playlist?\n\nNombre: ${name}\nSeguidores: ${followers}`)) {
                return;
            }
            
            try {
                const { error } = await supabaseClient
                    .from('playlists')
                    .update({
                        estado: 'aprobada',
                        followers: parseInt(followers),
                        nombre: name,
                        imagen_url: image,
                        ultima_actualizacion: new Date().toISOString()
                    })
                    .eq('id', playlistId);
                
                if (error) throw error;
                
                alert('‚úÖ Playlist aprobada correctamente');
                cargarPlaylistsPendientes();
                
            } catch (err) {
                console.error('‚ùå Error:', err);
                alert('‚ùå Error: ' + err.message);
            }
        }

        // ========================================
        // RECHAZAR PLAYLIST
        // ========================================
        async function rechazarPlaylist(playlistId) {
            const motivo = prompt('Motivo del rechazo:\n\nEjemplos:\n- La playlist no te pertenece\n- Datos incorrectos\n- Contenido inapropiado');
            
            if (!motivo || motivo.trim() === '') {
                alert('‚ö†Ô∏è Debes proporcionar un motivo');
                return;
            }
            
            if (!confirm(`¬øRechazar esta playlist?\n\nMotivo: ${motivo}`)) {
                return;
            }
            
            try {
                const { error } = await supabaseClient
                    .from('playlists')
                    .update({
                        estado: 'rechazada',
                        motivo_rechazo: motivo.trim()
                    })
                    .eq('id', playlistId);
                
                if (error) throw error;
                
                alert('‚ùå Playlist rechazada');
                cargarPlaylistsPendientes();
                
            } catch (err) {
                console.error('‚ùå Error:', err);
                alert('‚ùå Error: ' + err.message);
            }
        }

        // Filtrar usuarios
        function filtrarUsuarios() {
            const searchTerm = document.getElementById('searchUsuarios').value.toLowerCase();
            const rows = document.querySelectorAll('#tablaUsuarios tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        // Filtrar por tipo
        function filtrarPorTipo(tipo) {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            const rows = document.querySelectorAll('#tablaUsuarios tr');
            rows.forEach(row => {
                if (tipo === 'todos') {
                    row.style.display = '';
                } else {
                    const badge = row.querySelector('.badge');
                    if (badge) {
                        const rowTipo = badge.textContent.toLowerCase().includes(tipo);
                        row.style.display = rowTipo ? '' : 'none';
                    }
                }
            });
        }

        // Ver usuario
        async function verUsuario(userId, email) {
            try {
                const { data: usuario, error } = await supabaseClient
                    .from('usuarios')
                    .select('*')
                    .eq('id', userId)
                    .single();
                
                if (error) throw error;
                
                const info = `
üìß Email: ${usuario.email}
üë§ Nombre: ${usuario.nombre}
üé≠ Tipo: ${usuario.tipo}
üí∞ Cr√©ditos: ${usuario.creditos}
üíµ Balance: ‚Ç¨${usuario.balance}
üîó C√≥digo Referido: ${usuario.codigo_referido}
üìÖ Registrado: ${new Date(usuario.created_at).toLocaleString('es-ES')}
                `;
                
                alert(info);
            } catch (err) {
                console.error('Error:', err);
                alert('Error al cargar datos del usuario');
            }
        }

        // Eliminar usuario
        async function eliminarUsuario(userId, email) {
            if (!confirm(`¬øEliminar usuario ${email}?\n\n‚ö†Ô∏è Esta acci√≥n no se puede deshacer.`)) {
                return;
            }
            
            try {
                const { error } = await supabaseClient
                    .from('usuarios')
                    .delete()
                    .eq('id', userId);
                
                if (error) throw error;
                
                alert('‚úÖ Usuario eliminado correctamente');
                await cargarUsuariosReales();
            } catch (err) {
                console.error('Error:', err);
                alert('‚ùå Error al eliminar usuario');
            }
        }

        // Guardar precios
        function guardarPrecios() {
            const standard = document.getElementById('precioStandard').value;
            const premium = document.getElementById('precioPremium').value;
            alert(`‚úÖ Precios actualizados:\n\nStandard: ${standard}‚Ç¨\nPremium: ${premium}‚Ç¨`);
        }

        // Guardar comisiones
        function guardarComisiones() {
            const plataforma = document.getElementById('comisionPlataforma').value;
            const referidos = document.getElementById('comisionReferidos').value;
            alert(`‚úÖ Comisiones actualizadas:\n\nPlataforma: ${plataforma}%\nReferidos: ${referidos}%`);
        }

        // Limpiar cach√©
        function limpiarCache() {
            if (confirm('¬øLimpiar cach√©?')) {
                alert('‚úÖ Cach√© limpiado');
            }
        }

        // Resetear datos
        function resetearDatos() {
            if (confirm('‚ö†Ô∏è ¬øResetear todos los datos demo?')) {
                alert('‚úÖ Datos reseteados');
            }
        }

        // Exportar reporte
        function exportarReporte() {
            alert('üì• Exportando reporte CSV...');
        }

        // Verificar sesi√≥n al cargar
        window.addEventListener('load', () => {
            if (sessionStorage.getItem('adminLoggedIn') === 'true') {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
                cargarUsuariosReales();
                cargarPlaylistsPendientes();
                cargarTodasPlaylists();
            }
        });
    </script>
</body>
</html>
